---
title: "Code for plots"
author: "Dr. Shirin Elsinghorst"
bibliography: references.bib
date: "8/26/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.align="center")
```

```{r libraries}
library(tidyverse)
library(ggExtra)
library(ragg)
library(palmerpenguins)
```

[@r4ds]

## Dataset

```{r}
head(penguins)
#head(penguins_raw)
```

```{r eval=FALSE}
p <- penguins %>%
  ggplot(aes(x = bill_length_mm, y = flipper_length_mm,
              color = species)) +
    geom_point()

pngfile <- fs::path(knitr::fig_path(),  "scaling.png")
agg_png(pngfile, width = 60, height = 36, units = "cm", res = 300, scaling = 3)
plot(p)
invisible(dev.off())
knitr::include_graphics(pngfile)
```

## Colors

- set [colorblind-friendly palettes](https://jfly.uni-koeln.de/color/)

```{r}
# The palette with grey:
cbp1 <- c("#999999", "#E69F00", "#56B4E9", "#009E73",
          "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# The palette with black:
cbp2 <- c("#000000", "#E69F00", "#56B4E9", "#009E73",
          "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

```{r}
ggplot <- function(...) ggplot2::ggplot(...) + 
  scale_color_manual(values = cbp1) +
  scale_fill_manual(values = cbp1) +
  theme_bw()
```

## Main Diagram types

https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf

### Point chart

```{r}
(
  p <- penguins %>%
    remove_missing() %>%
    ggplot(aes(x = bill_length_mm, y = flipper_length_mm,
              color = species, shape = species)) +
    geom_point() +
    labs(x = "Bill length (mm)", 
         y = "Flipper length (mm)",
        title = "Scatterplot", 
        subtitle = "Penguins bill v. flipper length by species",
        caption = "Source: https://github.com/allisonhorst/palmerpenguins")
)
```

```{r eval=FALSE}
pngfile <- fs::path("Figs",  "scatterplot.png")
agg_png(pngfile, width = 60, height = 36, units = "cm", res = 100, scaling = 4)
plot(p)
invisible(dev.off())
knitr::include_graphics(pngfile)
```

- Jitter with smoothing line

```{r}
(
  p <- penguins %>%
    remove_missing() %>%
    ggplot(aes(x = bill_length_mm, y = flipper_length_mm,
              color = species, shape = species)) +
    geom_jitter(alpha = 0.5) +
    geom_smooth(method = "loess", se = TRUE) +
    facet_wrap(vars(species), nrow = 3) +
    labs(x = "Bill length (mm)", 
         y = "Flipper length (mm)",
        title = "Scatterplot with smoothing line", 
        subtitle = "Penguins bill v. flipper length by species with loess smoothing line",
        caption = "Source: https://github.com/allisonhorst/palmerpenguins")
)
```

```{r eval=FALSE}
pngfile <- fs::path("Figs",  "scattersmooth.png")
agg_png(pngfile, width = 60, height = 50, units = "cm", res = 100, scaling = 4)
plot(p)
invisible(dev.off())
knitr::include_graphics(pngfile)
```

```{r}
p <- penguins %>%
  remove_missing() %>%
  filter(species == "Adelie") %>%
  ggplot(aes(x = bill_length_mm, y = flipper_length_mm)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "loess", se = TRUE) +
    labs(x = "Bill length (mm)", 
         y = "Flipper length (mm)",
        title = "Scatterplot with smoothing line", 
        subtitle = "Penguins bill v. flipper length by species with\nloess smoothing line, histogram & density distribution",
        caption = "Source: https://github.com/allisonhorst/palmerpenguins")

#(p <- ggMarginal(p, type = "densigram", fill = "transparent"))
```

```{r eval=FALSE}
pngfile <- fs::path("Figs",  "scatterhist.png")
agg_png(pngfile, width = 60, height = 50, units = "cm", res = 100, scaling = 4)
ggMarginal(p, type = "densigram", fill = "transparent")
invisible(dev.off())
knitr::include_graphics(pngfile)
```

### Bubble chart

```{r}
(
  p <- penguins %>%
    remove_missing() %>%
    ggplot(aes(x = bill_length_mm, y = flipper_length_mm,
              color = species, shape = species, size = body_mass_g)) +
    geom_point(alpha = 0.5) +
    labs(x = "Bill length (mm)", 
         y = "Flipper length (mm)",
        title = "Bubble plot", 
        subtitle = "Penguins bill v. flipper length by species; size indicates body mass in grams",
        caption = "Source: https://github.com/allisonhorst/palmerpenguins")
)
```

```{r eval=FALSE}
pngfile <- fs::path("Figs",  "bubble.png")
agg_png(pngfile, width = 60, height = 40, units = "cm", res = 100, scaling = 4)
plot(p)
invisible(dev.off())
knitr::include_graphics(pngfile)
```

### Line chart

```{r}
(
  p <- penguins %>%
    remove_missing() %>%
    ggplot(aes(x = bill_length_mm, y = flipper_length_mm,
               color = species)) +
    geom_line() +
    facet_wrap(vars(species, sex), nrow = 3) +
    labs(x = "Bill length (mm)", 
         y = "Flipper length (mm)",
        title = "Line plot", 
        subtitle = "Penguins bill v. flipper length by species and sex",
        caption = "Source: https://github.com/allisonhorst/palmerpenguins")
)
```

```{r eval=FALSE}
pngfile <- fs::path("Figs",  "linechart.png")
agg_png(pngfile, width = 60, height = 60, units = "cm", res = 100, scaling = 4)
plot(p)
invisible(dev.off())
knitr::include_graphics(pngfile)
```

### Correlation plots / heatmap

```{r}
mat <- penguins %>%
  remove_missing() %>%
  select(bill_depth_mm, bill_length_mm, body_mass_g, flipper_length_mm)

cormat <- round(cor(mat), 2)
cormat[upper.tri(cormat)] <- NA

cormat <- cormat %>%
  as_data_frame() %>%
  mutate(x = colnames(mat)) %>%
  gather(key = "y", value = "value", bill_depth_mm:flipper_length_mm)

(
  p <- cormat %>%
    remove_missing() %>%
    arrange(x, y) %>%
    ggplot(aes(x = x, y = y, fill = value)) + 
    geom_tile() +
    scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
     midpoint = 0, limit = c(-1,1), space = "Lab", 
     name = "Pearson\nCorrelation") +
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
    coord_fixed() +
      labs(x = "", 
           y = "",
          title = "Correlation heatmap", 
          subtitle = "Correlation btw. penguins' traits",
          caption = "Source: https://github.com/allisonhorst/palmerpenguins")
)
```

```{r eval=FALSE}
pngfile <- fs::path("Figs",  "corplot.png")
agg_png(pngfile, width = 60, height = 60, units = "cm", res = 100, scaling = 5)
plot(p)
invisible(dev.off())
knitr::include_graphics(pngfile)
```

### Bar chart

- per default: counts

```{r}
(
  p <- penguins %>%
    remove_missing() %>%
    ggplot(aes(x = species,
               fill = sex)) +
    geom_bar() +
      labs(x = "Species", 
           y = "Counts",
          title = "Barchart", 
          subtitle = "Counts of male & female penguins per species in study",
          caption = "Source: https://github.com/allisonhorst/palmerpenguins")
)
```

```{r eval=FALSE}
pngfile <- fs::path("Figs",  "barchart.png")
agg_png(pngfile, width = 60, height = 50, units = "cm", res = 100, scaling = 4)
plot(p)
invisible(dev.off())
knitr::include_graphics(pngfile)
```

```{r}
(
  p <- penguins %>%
    remove_missing() %>%
    ggplot(aes(x = species,
               fill = sex)) +
    geom_bar(position = 'dodge') +
      labs(x = "Species", 
           y = "Counts",
          title = "Barchart", 
          subtitle = "Counts of male & female penguins per species in study",
          caption = "Source: https://github.com/allisonhorst/palmerpenguins")
)
```

```{r eval=FALSE}
pngfile <- fs::path("Figs",  "barchart_dodge.png")
agg_png(pngfile, width = 60, height = 50, units = "cm", res = 100, scaling = 4)
plot(p)
invisible(dev.off())
knitr::include_graphics(pngfile)
```

- alternative: set y-values

```{r}
(
  p <- penguins %>%
    remove_missing() %>%
    group_by(species, sex) %>%
    summarise(mean_bmg = mean(body_mass_g)) %>%
    ggplot(aes(x = species, y = mean_bmg,
               fill = sex)) +
    geom_bar(stat = "identity", position = "dodge") +
      labs(x = "Species", 
           y = "Mean body mass (in g)",
          title = "Barchart", 
          subtitle = "Mean body mass of male & female penguins per species",
          caption = "Source: https://github.com/allisonhorst/palmerpenguins")
)
```

```{r eval=FALSE}
pngfile <- fs::path("Figs",  "barchart_dodge_bmg.png")
agg_png(pngfile, width = 60, height = 50, units = "cm", res = 100, scaling = 4)
plot(p)
invisible(dev.off())
knitr::include_graphics(pngfile)
```

### Boxplot

```{r}
(
  p <- penguins %>%
    remove_missing() %>%
    ggplot(aes(x = species, y = body_mass_g,
               fill = sex)) +
    geom_boxplot()
)
```

### Violin plot

```{r}
(
  p <- penguins %>%
    remove_missing() %>%
    ggplot(aes(x = species, y = body_mass_g,
               fill = sex)) +
    geom_violin()
)
```

### Pie chart

```{r}
(
  p <- penguins %>%
    remove_missing() %>%
    group_by(species, sex) %>%
    summarise(n = n()) %>%
    mutate(freq = n / sum(n),
           percentage = freq * 100) %>%
    ggplot(aes(x = "", y = percentage,
               fill = sex)) +
    facet_wrap(vars(species), nrow = 1) +
    geom_bar(stat = "identity") +
    coord_polar("y", start=0)
)
```

### Alluvial charts

```{r}
library(ggalluvial)
```

```{r}
ggplot(as.data.frame(UCBAdmissions),
       aes(y = Freq, axis1 = Gender, axis2 = Dept)) +
  geom_alluvium(aes(fill = Admit), width = 1/12) +
  geom_stratum(width = 1/12, fill = "black", color = "grey") +
  geom_label(stat = "stratum", aes(label = after_stat(stratum))) +
  scale_x_discrete(limits = c("Gender", "Dept"), expand = c(.05, .05)) +
  ggtitle("UC Berkeley admissions and rejections, by sex and department")
```

### Maps

https://shiring.shinyapps.io/wgs_app

### Other

- Dumbbell plots
- Slope charts
- Treemaps
- Dendrograms
- Area charts
- Waterfall charts
- Sankey diagrams
- Biplots
- Radar charts
- Word clouds
- etc.

---

```{r}
devtools::session_info()
```

